<!-- (scroll)="handleShowScrollArrow($event)" -->
<div class="app-root">
<div id="content-scrollable" class="container">
  
  <div *ngIf="!isLoginKiosk || (kioskStatus$ | async) === 'REGISTERED'; else kioskStatusBlock" class="flex-container-column">
    <router-outlet></router-outlet>
    <app-footer *ngIf="!helper.view"></app-footer>
  </div>

  <!-- Template para bloqueos de estado del Kiosco -->
  <ng-template #kioskStatusBlock>
    <div class="kiosk-overlay">
      
      <!-- HEADER FIJO (Oculto en LOADING) -->
      <div class="brand-header" *ngIf="(kioskStatus$ | async) !== 'LOADING'">
        <img src="assets/images/fibex-logo-positive.png" alt="Fibex" class="logo-overlay"> 
      </div>

      <!-- CONTENIDO DINMICO SEGN ESTADO -->
      <div [ngSwitch]="kioskStatus$ | async" class="status-container">

        <!-- LOADING -->
        <div *ngSwitchCase="'LOADING'" class="loading-minimal">
          <div class="loader-ring white"></div>
          <h2>Validando Kiosko...</h2>
        </div>

        <!-- NOT_REGISTERED -->
        <div *ngSwitchCase="'NOT_REGISTERED'" class="status-card">
          <div class="icon-circle warning">
            <i class="fa fa-cogs"></i>
          </div>
          <h2>Configuraci贸n del Kiosko</h2>
          <p>Este kiosko requiere activaci贸n por parte del personal autorizado para operar.</p>
          
          <div class="tech-details">
            <div class="uuid-container">
              <small>ID DEL KIOSKO</small>
              <code>{{ kioskUuid }}</code>
            </div>
          </div>

          <button class="btn-primary-action" (click)="retryAuth()">
            <i class="fa fa-refresh"></i> Verificar Activaci贸n
          </button>
        </div>

        <!-- DISABLED -->
        <div *ngSwitchCase="'DISABLED'" class="status-card">
          <div class="icon-circle locked">
            <i class="fa fa-ban"></i>
          </div>
          <h2>Kiosko Inhabilitado</h2>
          <p>Este Kiosko se encuentra temporalmente fuera de servicio.</p>
          
          <button class="btn-primary-action" (click)="retryAuth()">
             <i class="fa fa-sync"></i> Verificar Acceso
          </button>
        </div>

        <!-- ERROR -->
        <div *ngSwitchCase="'ERROR'" class="status-card">
          <div class="icon-circle network">
            <i class="fa fa-wifi"></i>
          </div>
          <h2>Sin Conexi贸n</h2>
          <p>No se puede establecer comunicaci贸n con el servidor central.</p>
          <button class="btn-primary-action" (click)="retryAuth()">
            <i class="fa fa-refresh"></i> Reintentar Ahora
          </button>
        </div>

      </div>

      <!-- FOOTER FIJO (Oculto en LOADING) -->
      <div class="footer-info" *ngIf="(kioskStatus$ | async) !== 'LOADING'">
        <small>Fibex AutoPago v1.0.0</small>
      </div>

    </div>
  </ng-template>

  <!-- Carrusel de publicidad - Solo en vista de inicio -->
  <!--  DESHABILITADO: Para habilitar cambiar ENABLE_AD_CAROUSEL a true en app.component.ts -->
  <app-ad-carousel 
    *ngIf="showAdCarousel && !helper.view && !(adminPanelOpen$ | async)" 
    (touch)="hideAdCarousel()"
    (click)="hideAdCarousel()">
  </app-ad-carousel>

    <!-- * Arrow button to scroll up -->
    <!-- <button class="arrow_up animated faster" (click)="scrollToTop()" [class.fadeInUp]="showScrollArrow"
    [class.fadeOutDown]="!showScrollArrow">
    <img src="../assets/images/arrow_up.png" alt="Ir hacia arriba">
  </button> -->
</div>

  <!-- Pantalla de inactividad: iframe a pantalla completa, bot贸n superpuesto abajo (entrada/salida suave) -->
  <div class="idle-page-overlay" [class.idle-page-overlay--visible]="showIdlePage" [attr.aria-hidden]="!showIdlePage">
    <div class="idle-page-iframe-zone">
      <iframe [src]="idlePageUrlSafe" class="idle-page-iframe" title="P谩gina de inactividad"></iframe>
    </div>
    <div class="idle-page-button-zone" (click)="onIdleButtonInteraction($event)" (touchstart)="onIdleButtonInteraction($event)">
      <div class="idle-page-chevron" aria-hidden="true">
        <i class="fa fa-chevron-down"></i>
      </div>
      <button type="button" class="idle-page-btn" (click)="onIdleButtonInteraction($event)" (touchstart)="onIdleButtonInteraction($event)">Empezar</button>
    </div>
  </div>
</div>

<div class="login-flow-container">
  
  <!-- STEP 1: LOGIN FORM -->
  <div *ngIf="currentStep === LoginStep.LOGIN" class="login-wrapper">
    <div class="login-container">
      <div class="login-header">
        <div class="login-icon">
          <i class="fas fa-lock"></i>
        </div>
        <h2 class="login-title">Iniciar Sesión</h2>
        <p class="login-subtitle">Ingresa tus credenciales para continuar</p>
      </div>

      <form [formGroup]="formLogin" (ngSubmit)="onSubmit()" class="login-form">
        <div class="form-group">
          <div class="input-wrapper">
            <i class="fas fa-user input-icon"></i>
            <input 
              id="user" 
              type="text" 
              formControlName="user"
              placeholder="Usuario"
              class="form-input"
              [class.input-error]="formLogin.get('user')?.invalid && formLogin.get('user')?.touched"
              autocomplete="username">
            <label for="user" class="input-label">Usuario</label>
          </div>
          <div 
            class="error-message" 
            *ngIf="formLogin.get('user')?.invalid && formLogin.get('user')?.touched"
            [@slideDown]>
            <i class="fas fa-exclamation-circle"></i>
            <span>El usuario es obligatorio</span>
          </div>
        </div>

        <div class="form-group">
          <div class="input-wrapper">
            <i class="fas fa-lock input-icon"></i>
            <input 
              id="pass" 
              type="password" 
              formControlName="pass"
              placeholder="Contraseña"
              class="form-input"
              [class.input-error]="formLogin.get('pass')?.invalid && formLogin.get('pass')?.touched"
              autocomplete="current-password">
            <label for="pass" class="input-label">Contraseña</label>
          </div>
          <div 
            class="error-message" 
            *ngIf="formLogin.get('pass')?.errors?.['required'] && formLogin.get('pass')?.touched"
            [@slideDown]>
            <i class="fas fa-exclamation-circle"></i>
            <span>La contraseña es obligatoria</span>
          </div>
          <div 
            class="error-message" 
            *ngIf="formLogin.get('pass')?.errors?.['minlength'] && formLogin.get('pass')?.touched"
            [@slideDown]>
            <i class="fas fa-exclamation-circle"></i>
            <span>La contraseña debe tener al menos 6 caracteres</span>
          </div>
        </div>

        <button 
          type="submit" 
          class="login-button"
          [disabled]="formLogin.invalid || submitted"
          [class.loading]="submitted">
          <span class="button-text" *ngIf="!submitted">
            <i class="fas fa-sign-in-alt"></i>
            Entrar
          </span>
          <span class="button-loading" *ngIf="submitted">
            <i class="fas fa-spinner fa-spin"></i>
            Iniciando sesión...
          </span>
        </button>
      </form>
    </div>
  </div>

  <!-- STEP 2: CHECKOUT SELECTION -->
  <div *ngIf="currentStep === LoginStep.CHECKOUT_SELECTION" class="checkout-selector-container">
    <h2>Seleccionar Caja</h2>
    
    <div class="checkouts-list">
      <div 
        *ngFor="let checkout of availableCheckouts" 
        class="checkout-card"
        (click)="onCheckoutSelected(checkout)">
        <div class="checkout-info">
          <h3>{{ checkout.checkout_identify }}</h3>
          <p><strong>Modelo:</strong> {{ checkout.checkoutModel }}</p>
          <p><strong>Serial:</strong> {{ checkout.checkoutSerial }}</p>
          <p><strong>Estado:</strong> <span class="status-active">Disponible</span></p>
        </div>
      </div>

      <div *ngIf="availableCheckouts.length === 0" class="no-results">
        No hay cajas disponibles para esta sede.
      </div>
    </div>

    <div class="actions-container">
      <button class="btn-secondary" (click)="onCancel()">
        Cancelar
      </button>
    </div>
  </div>

  <!-- STEP 3: POS DEVICE SELECTION -->
  <div *ngIf="currentStep === LoginStep.POS_SELECTION" class="pos-selector-container">
    <h2>Seleccionar Dispositivo POS</h2>
    
    <div class="search-container">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="filterPosDevices()"
        placeholder="Buscar por modelo, serial o terminal..."
        class="search-input">
    </div>

    <div class="pos-devices-list">
      <div 
        *ngFor="let device of filteredPosDevices" 
        class="pos-device-card"
        (click)="onPosSelected(device)">
        <div class="device-info">
          <h3>{{ device.terminalVirtual }}</h3>
          <p><strong>Modelo:</strong> {{ device.device_model }}</p>
          <p><strong>Serial:</strong> {{ device.serial_number }}</p>
          <p><strong>IP:</strong> {{ device.ip_address }}:{{ device.port }}</p>
          <p><strong>Estado:</strong> <span class="status-{{ device.status.toLowerCase() }}">{{ device.status }}</span></p>
        </div>
      </div>

      <div *ngIf="filteredPosDevices.length === 0" class="no-results">
        No se encontraron dispositivos POS disponibles.
      </div>
    </div>

    <div class="actions-container">
      <button class="btn-secondary" (click)="onCancel()">
        Cancelar
      </button>
    </div>
  </div>

</div>

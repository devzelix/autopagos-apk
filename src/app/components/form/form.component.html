<form class="form-login" id="form-offer" *ngIf="!showStateTable">

  <div class="form-login__offer">
    <span
      class="button-link__bold button-link button__secondary btn-width-70 fancy_shadow main-title-login-container"
    >
      <!-- <p>Registre su pago</p>
      <p>Servicio de Internet</p> -->
      <img class="fibex-main-title-logo" src="assets/images/fibex-logo-positive.png" alt="Fibex Telecom Logo">
      <h1 class="main-title-login">Registre su pago <strong>FIBEX!</strong></h1>
    </span>
  </div>

  <div *ngIf="AppFibex && nameClient" class="subtitle-info">
    <h1 class="name-client">
      Hola, {{ nameClient }}
    </h1>
  </div>

  <!-- [className]="nameClient ? 'form-login__group2 fancy_shadow' : 'form-login__group fancy_shadow'" -->
  <div
    class="form-login__group fancy_shadow"
    [ngClass]="nameClient ? 'form-login__group2' : ''"
  >

    <!-- FORMAS DE PAGO --->
    <button
      *ngIf="AppFibex"
      class="btn-flotante left"
      title="Últimos pagos"
      (click)="openInfoPay()"
    >
      <!-- <mat-icon><span class="material-symbols-outlined">list</span></mat-icon> -->
      <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="currentColor" d="M7 9V7h14v2zm0 4v-2h14v2zm0 4v-2h14v2zM4 9q-.425 0-.712-.288T3 8t.288-.712T4 7t.713.288T5 8t-.288.713T4 9m0 4q-.425 0-.712-.288T3 12t.288-.712T4 11t.713.288T5 12t-.288.713T4 13m0 4q-.425 0-.712-.288T3 16t.288-.712T4 15t.713.288T5 16t-.288.713T4 17"/></svg>
    </button>
    <button
      *ngIf="AppFibex"
      class="btn-flotante right"
      title="Formas de Pago"
      (click)="openDialogPM()"
    >
      <!-- <mat-icon
        ><span class="material-icons-outlined">help_outline</span></mat-icon
      > -->
      <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.195 8.765A4 4 0 1 1 12 14v1m.05 4v.1h-.1V19z"/></svg>
    </button>

    <!-- Mensajes de alerta -->
    <div>
      <h3
        class="message-succes"
        *ngIf="payReported && !playDuplicated"
        (click)="payReported = !payReported"
      >
        Gracias por su pago, el mismo se encuentra en proceso de conciliación el
        cual dura entre 24 a 48 horas ({{ Contar }})
      </h3>
      <h3
        class="message-succes"
        *ngIf="CuentaAnulada && !playDuplicated"
        (click)="CuentaAnulada = !CuentaAnulada"
      >
        No es posible registrar su pago porque se cuenta está ANULADA o RETIRADA
        ({{ Contar }})
      </h3>
      <h3
        class="message-warning"
        *ngIf="playDuplicated && !payReported"
        (click)="playDuplicated = !playDuplicated"
      >
        No es posible registrar el mismo pago dos veces ({{ Contar }})
      </h3>
      <h3 class="message-warning" *ngIf="ErrorRegistrando">
        {{ MessageErrorRegistrado }} ({{ Contar }})
      </h3>
    </div>
    <!-- Mensajes de alerta -->

    <div
      *ngIf="
        !payReported ||
        (CuentaAnulada && !playDuplicated) ||
        ErrorRegistrando ||
        (playDuplicated && !payReported)
      "
      class="section-step-container"
    >
      <!-- Menú ppal si la ruta no tiene la cedula del cliente -->
      <div *ngIf="showDniForm && !AppFibex" class="section-step-item keypad-form-step">

        <div class="form-dni-section">

          <ng-template matStepLabel>Cliente</ng-template>

          <div class="form-login__item" fxFlex="1 0 auto" fxLayout="column">
            <div *ngIf="listContratos.length < 1 && !LoadingLengthAbonado" div="form-control-item-container" [formGroup]="firstFormFibex">
              <!-- <label>Cédula/RIF del cliente</label>
              <input
                formControlName="dni"
                type="number"
                matInput
                required
                NumbersOnly="true"
                #inputDni
                [readonly]="readonlyDNI"
                minlength="6"

              /> -->
              
              
              <label class="form-control-label"> {{ selectType.value === 'V' ? 'Cédula del cliente' : 'Jurídico' }} </label>

              <div class="form-control-input form-dni-input">
                <select #selectType (change)="onLoginTypeChange(selectType.value)">
                  <option value="V" selected>V</option>
                  <option value="J">J</option>
                </select>
                <h4 [ngClass]="{'form-input-empty': (firstFormFibex.get('dni')?.value.length === 0), 'text-sm': (firstFormFibex.get('dni')?.value.length > 10)}">
                  {{ (firstFormFibex.get('dni')?.value) ? firstFormFibex.get('dni')?.value : '········' }} 
                </h4>
              </div>


              <p class="form-control-error-text" *ngIf="firstFormFibex.get('dni')?.dirty && firstFormFibex.get('dni')?.hasError('required')">
                La cédula es requerida
              </p>
             <!--  <p class="form-control-error-text" *ngIf="firstFormFibex.get('dni')?.value.length < 6">
                Ingrese al menos 6 dígitos
              </p> -->
            </div>
            <button
              *ngIf="listContratos.length < 1 && !LoadingLengthAbonado && (listContratos.length == 0 || listContratos.length == 1)"
              class="form-control-btn"
              type="button"
              role="button"
              (click)="searchServicesv2(firstFormFibex.get('dni'), false, true)"
              [disabled]="dni?.invalid"
            >
              Consultar
            </button>
            <!-- /Muestra de boton consultar -->

            <!-- En caso de tener dos o más abonados -->
             
            <h3 class="message-succes" *ngIf="listContratos.length > 1">
              Por favor seleccione su Nro. de Abonado
            </h3>
            <div *ngIf="LoadingLengthAbonado" class="spinner-pay">
              <mat-spinner></mat-spinner>
            </div>
            <div
              *ngIf="listContratos.length > 1 && !LoadingLengthAbonado"
              class="grid-cards cards-abonados animated fadeInUp"
            >
              <button
                *ngFor="let contrato of listContratos"
                class="grid-cards-item"
                (click)="contractSelected(contrato, true)"
              >
                <h3>
                  {{ contrato.contrato }}
                </h3>
                <p *ngIf="contrato.sector">
                  {{ contrato.sector }}
                </p>
                <p>
                  {{ contrato.status_contrato }}
                </p>
              </button>
            </div>
            <!--  / En caso de tener dos o más abonados -->
          </div>
        </div>

        <app-keyboard-on-screen *ngIf="listContratos.length < 1 && !LoadingLengthAbonado"
          [isValidEnterBtn]="!dni?.invalid"
          classes="pinpad-big-size"
          (valorTeclado)="onTecladoInput($event)"
          (deleteKeyEmitter)="deleteLastCharacter()"
          (enterEmitter)="searchServicesv2(firstFormFibex.get('dni'), false, true)"
        >
        </app-keyboard-on-screen>

      </div>

      <!--/ Fin de Menú ppal -->

      <!-- Menú de métodos de pago -->
      <div *ngIf="AppFibex" class="CardPpal" class="section-step-item">
        <div
          *ngIf="
            nameClient &&
            saldoBs &&
            saldoUSD &&
            registerPayService.linkedToContractProcess != 'approved'
          "
          class="desc-user"
        >
          <div>
            <h4 class="name-client">
              {{ nameClient }}
            </h4>
            <h4 class="name-client">
              {{ saldoUSD | negativeAmount }} USD |
              {{ saldoBs | negativeAmount }} Bs {{ saldoText }}
            </h4>
          </div>
          <div>
            <h4 class="name-client">Servicio: {{ paquete }}</h4>
            <h4 class="name-client">Suscripción: {{ subscription }} USD</h4>
          </div>
        </div>
        <div
          *ngIf="
            nameClient &&
            saldoBs &&
            saldoUSD &&
            registerPayService.linkedToContractProcess == 'approved'
          "
          class="desc-user"
        >
          <div>
            <h4 class="name-client">CI/RIF: {{ nameClient }}</h4>
            <h4 class="name-client">
              Monto a Pagar: {{ saldoUSD | negativeAmount }} USD |
              {{ saldoBs | negativeAmount }} Bs
            </h4>
          </div>
          <!-- <div>
            <h4 class="name-client">
            </h4>
            <h4 class="name-client">
            </h4>
          </div> -->
        </div>

        <ng-template matStepLabel>Tipo de pago</ng-template>
        <div class="spinner-pay">
          <mat-spinner *ngIf="LoadingPagoPendiente"></mat-spinner>
        </div>
        <div *ngIf="!PagoPendiente && !LoadingPagoPendiente" class="cardflex">
          <div
            *ngFor="let option of PagoMetodosHTML2"
            class="unicard width_full"
            [ngClass]="{ hide: option.tipopago === 'Criptomoneda' }"
          >
            <span
              [ngSwitch]="option.tipopago"
              class="opt-cards-container-size"
              (click)="showConsole(option)"
            >
              <span
                *ngSwitchCase="'FormasDePago'"
                class="grid-cards animated fadeInUp"
              >
                <button
                  *ngIf="!option.omitir"
                  class="grid-cards-item forma-pago"
                  (click)="FormaPago(option.idpago)"
                >
                  <h3>
                    {{ option.tittle }}
                  </h3>
                </button>
              </span>


              <span *ngSwitchDefault class="flex_center cardflex2">
                <!--  -->
                <button
                  *ngIf="!option.omitir"
                  class="fancy_card animated fadeInUp"
                  (click)="TipoPago(option.idpago)"
                >
                  <h5 class="TitlePerson">{{ option.tipopago }}</h5>
                  <img
                    style="width: 100%"
                    src="{{ option.image }}"
                    alt="{{ option.alt }}"
                  />
                </button>
              </span>
            </span>
          </div>
        </div>
        <div *ngIf="PagoPendiente && !LoadingPagoPendiente">
          <app-detalle-pay
            [DataPagoPendiente]="DataPagoPendiente"
          ></app-detalle-pay>
        </div>
        <button
          *ngIf="BackFormaPago && !LoadingPagoPendiente"
          class="customized_btn_next width_full"
          (click)="FormaPago(31)"
        >
          REGRESAR
        </button>
      </div>
      <!-- / Fin de métodos de pago -->

      <!-- Transferencias -->
      <div
        *ngIf="
          !ConsultarPagoMovilboolean &&
          !DebitoCreditoboolean &&
          !RegistrarPagoMovilboolean &&
          AppFibex &&
          !Criptomoneda &&
          !Otros &&
          !PrimeraVez
        "
        class="section-step-item"
      >
        <ng-container
          *ngIf="
            possibleWithholdingAgent && selectedRetentionOption == 2 && !Kiosco
          "
        >
        </ng-container>

        <div>
          <ng-template matStepLabel>Confirmación</ng-template>
          <div class="spinner-pay" *ngIf="sendingPay">
            <mat-spinner></mat-spinner>
          </div>

          <h2 class="message-warning" *ngIf="!sendingPay">
            Por favor verifique sus datos y confirme la operación.
          </h2>
          <div class="card-pay">
            <div class="invoice-box">
              <table cellpadding="0" cellspacing="0">
                <tr class="top">
                  <td colspan="2">
                    <table>
                      <tr>
                        <td class="title">
                          <img
                            src="https://crm.thomas-talk.me/uploads/company/9a837ebc624921b826b5e1687f9001c6.png"
                            style="width: 60%; max-width: 300px"
                          />
                        </td>

                        <td>
                          Creada en: {{ dateToDay | date : "dd/MM/yyyy" }}<br />
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>

                <tr class="information">
                  <td colspan="2">
                    <table>
                      <tr>
                        <td>
                          Servicio: {{ paquete }}<br />
                          Suscripción: {{ subscription }} USD <br />
                          Monto pendiente: {{ saldoUSD | negativeAmount }} USD |
                          {{ saldoBs | negativeAmount }} Bs<br />
                          <strong>Banco receptor: {{ bank?.value }}</strong>
                        </td>

                        <td>
                          {{ nameClient }}<br />
                          DNI/RIF {{ dni?.value }}<br />
                          {{ email?.value }}
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>

                <tr class="heading">
                  <td>Usted va reportar un pago de</td>

                  <td>Monto #</td>
                </tr>

                <tr class="details">
                  <td>{{ paquete }}</td>

                  <td *ngIf="BancoNacional(bank?.value) != 'EUR'">
                    {{ totalAmount }}
                    {{ BancoNacional(bank?.value) ? "Bs." : "USD" }}
                  </td>
                  <td *ngIf="BancoNacional(bank?.value) == 'EUR'">
                    {{ totalAmount }} EUR
                  </td>
                </tr>

                <tr class="total">
                  <td></td>

                  <td *ngIf="BancoNacional(bank?.value) != 'EUR'">
                    Total: {{ totalAmount }}
                    {{ BancoNacional(bank?.value) ? "Bs." : "USD" }}
                  </td>
                  <td *ngIf="BancoNacional(bank?.value) == 'EUR'">
                    Total: {{ totalAmount }} EUR
                  </td>
                </tr>
              </table>
            </div>
          </div>
          <div class="btn-flex-center">
            <button
              class="button-material-next btn-width-70"
              mat-raised-button
              (click)="savePaymentV2()"
              [disabled]="DisableReg || showMessageErrorUpload"
            >
              Reportar pago
            </button>
            <button
              class="button-material-back btn-width-30"
              mat-raised-button
              (click)="resetStepper()"
            >
              Editar datos
            </button>
          </div>
        </div>
      </div>
      <!-- / Fin de Transferencias -->

      <!-- Crédito o Débito -->
      <div *ngIf="DebitoCreditoboolean" class="section-step-item">

        <div *ngIf="!ReciboPay">
          <div
            *ngIf="
              nameClient &&
              saldoBs &&
              saldoUSD &&
              registerPayService.linkedToContractProcess != 'approved'
            "
            class="desc-user"
          >
            <div>
              <h4 class="name-client">
                {{ nameClient }}
              </h4>
              <h4 class="name-client">
                {{ saldoUSD | negativeAmount }} USD |
                {{ saldoBs | negativeAmount }} Bs {{ saldoText }}
              </h4>
            </div>
            <div>
              <h4 class="name-client">Servicio: {{ paquete }}</h4>
              <h4 class="name-client">Suscripción: {{ subscription }} USD</h4>
            </div>
          </div>
          <div
            *ngIf="
              nameClient &&
              saldoBs &&
              saldoUSD &&
              registerPayService.linkedToContractProcess == 'approved'
            "
            class="desc-user"
          >
            <div>
              <h4 class="name-client">CI/RIF: {{ nameClient }}</h4>
              <h4 class="name-client">
                Monto a Pagar: {{ saldoUSD | negativeAmount }} USD |
                {{ saldoBs | negativeAmount }} Bs
              </h4>
            </div>
            <div>
              <h4 class="name-client">
                <!-- Servicio: {{ paquete }} -->
              </h4>
              <h4 class="name-client">
                <!-- Suscripción: {{subscription}} USD -->
              </h4>
            </div>
          </div>

          <!--Button to do pay with PINPAD -By:MR- -->
          <br>
          <button type="button" class="grid-cards-item forma-pago ng-star-inserted" (click)="_requestCard()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-credit-card-fill" viewBox="0 0 16 16">
              <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v1H0zm0 3v5a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7zm3 2h1a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1"/>
            </svg>
            Pagar
          </button>
          <br><br>
          <!--FIN
            Button to do pay with PINPAD -By:MR-
          FIN-->

          <button
            *ngIf="!ShowFormDebitoCreditoBNC && !ShowFormDebito100x100"
            class="customized_btn_next"
            [ngClass]="{
              'btn-width-30': ShowFormDebitoCredito,
              width_full: !ShowFormDebitoCredito
            }"
            (click)="ScrollUp($event); ResetFormCD()"
            type="button"
            matStepperPrevious
          >
            Regresar
          </button>
        </div>
      </div>
      <!-- / Fin de Crédito o Débito -->

      <div *ngIf="ShowFormDebito100x100" class="section-step-item">
        <ng-template matStepLabel>Débito inmediato</ng-template>
        <div *ngIf="!ReciboPay">
          <div
            *ngIf="
              nameClient &&
              saldoBs &&
              saldoUSD &&
              registerPayService.linkedToContractProcess != 'approved'
            "
            class="desc-user"
          >
            <div>
              <h4 class="name-client">
                {{ nameClient }}
              </h4>
              <h4 class="name-client">
                {{ saldoUSD | negativeAmount }} USD |
                {{ saldoBs | negativeAmount }} Bs {{ saldoText }}
              </h4>
            </div>
            <div>
              <h4 class="name-client">Servicio: {{ paquete }}</h4>
              <h4 class="name-client">Subscripción: {{ subscription }} USD</h4>
            </div>
          </div>
          <div
            *ngIf="
              nameClient &&
              saldoBs &&
              saldoUSD &&
              registerPayService.linkedToContractProcess == 'approved'
            "
            class="desc-user"
          >
            <div>
              <h4 class="name-client">CI/RIF: {{ nameClient }}</h4>
              <h4 class="name-client">
                Monto a Pagar: {{ saldoUSD | negativeAmount }} USD |
                {{ saldoBs | negativeAmount }} Bs
              </h4>
            </div>
            <div>
              <h4 class="name-client">
                <!-- Servicio: {{ paquete }} -->
              </h4>
              <h4 class="name-client">
                <!-- Subscripción: {{subscription}} USD -->
              </h4>
            </div>
          </div>

          <!-- !Creditoboolaean en false para solo mostrarlo para pago en debito-->
          <app-debito-100x100
            [DNI]="this.dni?.value"
            [SaldoBS]="saldoBs"
            [Abonado]="nroContrato?.value"
            [Contrato]="idContrato"
            (OutputResponse)="OutputDebito100x100($event)"
          ></app-debito-100x100>
        </div>
        <div *ngIf="ReciboPay">
          <app-table-receipt [cantidad]="montoDebito100"></app-table-receipt>
        </div>

        <div
          *ngIf="ReciboPay"
          fxLayout="row"
          fxLayoutAlign="center center"
          class="btn-flex-center"
        >
          <button
            class="button-material-back btn-width-30"
            (click)="
              ResetFormCD(); lastDni = ''; searchServicesv2(dni, false, false)
            "
            mat-raised-button
            type="button"
            matStepperPrevious
          >
            Regresar
          </button>
        </div>
      </div>

    </div>
  </div>
</form>

<app-info-pay
  *ngIf="showStateTable"
  [stateTableData]="stateTableData"
  [showStateTable]="showStateTable"
  (closeEvent)="showStateTable = false"
></app-info-pay>
